## ABSTRACT
Push-In First-Out（PIFO）队列是一种**硬件原语**，通过在**线速**下提供**优先队列（priority queue）**的抽象，使得**可编程分组调度**成为可能。然而，要在**大规模**场景下实现 PIFO 并不容易：目前仅有**硬件设计层面**的方案（尚无成熟实现），而且最多只能支持大约 **1k 条流**。

在本文中，我们提出了 **SP-PIFO**，一种**可编程分组调度器**，它利用**严格优先级队列（strict-priority queues）**在**现有设备**上、以**线速**和**可扩展**的方式，**近似实现 PIFO 队列的行为**。  
SP-PIFO 的核心洞察在于：**动态地调整分组 rank 与可用严格优先级队列之间的映射关系**，从而将相对于理想 PIFO 的调度误差最小化。

我们对该问题进行了**数学建模**，并推导出一种**无需任何流量先验知识**、却能**紧密逼近最优队列映射**的自适应方法。我们在 **P4** 中完整实现了 SP-PIFO，并在**真实工作负载**下对其进行了评估。

实验结果表明，SP-PIFO 具有以下优势：
1. **仅使用 8 个优先级队列**，就能与理想 PIFO 的行为高度一致；
2. 能够**扩展到大量流和 rank**；
3. 能够**快速适应流量变化**。
此外，我们还证明了 SP-PIFO 可以在**现有硬件（Barefoot Tofino）**上以**线速运行**，并且**内存开销可以忽略不计**。