
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://blowindingblog.cn/research/Scaling%20Router%20Queues/">
      
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Scaling Router Queues - blowinding's blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      
  
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1%207.775V2.75C1%201.784%201.784%201%202.75%201h5.025c.464%200%20.91.184%201.238.513l6.25%206.25a1.75%201.75%200%200%201%200%202.474l-5.026%205.026a1.75%201.75%200%200%201-2.474%200l-6.25-6.25A1.75%201.75%200%200%201%201%207.775m1.5%200c0%20.066.026.13.073.177l6.25%206.25a.25.25%200%200%200%20.354%200l5.025-5.025a.25.25%200%200%200%200-.354l-6.25-6.25a.25.25%200%200%200-.177-.073H2.75a.25.25%200%200%200-.25.25ZM6%205a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.5%201.75v11.5c0%20.138.112.25.25.25h3.17a.75.75%200%200%201%200%201.5H2.75A1.75%201.75%200%200%201%201%2013.25V1.75C1%20.784%201.784%200%202.75%200h8.5C12.216%200%2013%20.784%2013%201.75v7.736a.75.75%200%200%201-1.5%200V1.75a.25.25%200%200%200-.25-.25h-8.5a.25.25%200%200%200-.25.25m13.274%209.537zl-4.557%204.45a.75.75%200%200%201-1.055-.008l-1.943-1.95a.75.75%200%200%201%201.062-1.058l1.419%201.425%204.026-3.932a.75.75%200%201%201%201.048%201.074M4.75%204h4.5a.75.75%200%200%201%200%201.5h-4.5a.75.75%200%200%201%200-1.5M4%207.75A.75.75%200%200%201%204.75%207h2a.75.75%200%200%201%200%201.5h-2A.75.75%200%200%201%204%207.75%22/%3E%3C/svg%3E');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.5%207.75A.75.75%200%200%201%207.25%207h1a.75.75%200%200%201%20.75.75v2.75h.25a.75.75%200%200%201%200%201.5h-2a.75.75%200%200%201%200-1.5h.25v-2h-.25a.75.75%200%200%201-.75-.75M8%206a1%201%200%201%201%200-2%201%201%200%200%201%200%202%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M3.499.75a.75.75%200%200%201%201.5%200v.996C5.9%202.903%206.793%203.65%207.662%204.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873%2010.794-.045%2012.622.26%2014.408.558%2016%201.94%2016%204.25c0%201.278-.954%202.575-2.44%202.734l.146.508.065.22c.203.701.412%201.455.476%202.226.142%201.707-.4%203.03-1.487%203.898C11.714%2014.671%2010.27%2015%208.75%2015h-6a.75.75%200%200%201%200-1.5h1.376a4.5%204.5%200%200%201-.563-1.191%203.84%203.84%200%200%201-.05-2.063%204.65%204.65%200%200%201-2.025-.293.75.75%200%200%201%20.525-1.406c1.357.507%202.376-.006%202.698-.318l.009-.01a.747.747%200%200%201%201.06%200%20.75.75%200%200%201-.012%201.074c-.912.92-.992%201.835-.768%202.586.221.74.745%201.337%201.196%201.621H8.75c1.343%200%202.398-.296%203.074-.836.635-.507%201.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.4%202.4%200%200%201-.507-.441%203.1%203.1%200%200%201-.633-1.248.75.75%200%200%201%201.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738%200%201.25-.615%201.25-1.25%200-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706%201.345-.46.92-.27%201.774.019%203.062l.042.19.01.05c.348.443.666.949.94%201.553a.75.75%200%201%201-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7%205.527c-.814-.68-1.75-1.462-2.692-2.619a3.7%203.7%200%200%200-1.023.88c-.406.495-.663%201.036-.722%201.508.116.122.306.21.591.239.388.038.797-.06%201.032-.19a.75.75%200%200%201%20.728%201.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75%205.677V5.5c0-.984.48-1.94%201.077-2.664.46-.559%201.05-1.055%201.673-1.353z%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M13.78%204.22a.75.75%200%200%201%200%201.06l-7.25%207.25a.75.75%200%200%201-1.06%200L2.22%209.28a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018L6%2010.94l6.72-6.72a.75.75%200%200%201%201.06%200%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.92%206.085h.001a.749.749%200%201%201-1.342-.67c.169-.339.436-.701.849-.977C6.845%204.16%207.369%204%208%204a2.76%202.76%200%200%201%201.637.525c.503.377.863.965.863%201.725%200%20.448-.115.83-.329%201.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6%206%200%200%200-.26.16%201%201%200%200%200-.276.245.75.75%200%200%201-1.248-.832c.184-.264.42-.489.692-.661q.154-.1.313-.195l.007-.004c.1-.061.182-.11.258-.161a1%201%200%200%200%20.277-.245C8.96%206.514%209%206.427%209%206.25a.61.61%200%200%200-.262-.525A1.27%201.27%200%200%200%208%205.5c-.369%200-.595.09-.74.187a1%201%200%200%200-.34.398M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M6.457%201.047c.659-1.234%202.427-1.234%203.086%200l6.082%2011.378A1.75%201.75%200%200%201%2014.082%2015H1.918a1.75%201.75%200%200%201-1.543-2.575Zm1.763.707a.25.25%200%200%200-.44%200L1.698%2013.132a.25.25%200%200%200%20.22.368h12.164a.25.25%200%200%200%20.22-.368Zm.53%203.996v2.5a.75.75%200%200%201-1.5%200v-2.5a.75.75%200%200%201%201.5%200M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.344%202.343za8%208%200%200%201%2011.314%2011.314A8.002%208.002%200%200%201%20.234%2010.089a8%208%200%200%201%202.11-7.746m1.06%2010.253a6.5%206.5%200%201%200%209.108-9.275%206.5%206.5%200%200%200-9.108%209.275M6.03%204.97%208%206.94l1.97-1.97a.749.749%200%200%201%201.275.326.75.75%200%200%201-.215.734L9.06%208l1.97%201.97a.749.749%200%200%201-.326%201.275.75.75%200%200%201-.734-.215L8%209.06l-1.97%201.97a.749.749%200%200%201-1.275-.326.75.75%200%200%201%20.215-.734L6.94%208%204.97%206.03a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M9.504.43a1.516%201.516%200%200%201%202.437%201.713L10.415%205.5h2.123c1.57%200%202.346%201.909%201.22%203.004l-7.34%207.142a1.25%201.25%200%200%201-.871.354h-.302a1.25%201.25%200%200%201-1.157-1.723L5.633%2010.5H3.462c-1.57%200-2.346-1.909-1.22-3.004zm1.047%201.074L3.286%208.571A.25.25%200%200%200%203.462%209H6.75a.75.75%200%200%201%20.694%201.034l-1.713%204.188%206.982-6.793A.25.25%200%200%200%2012.538%207H9.25a.75.75%200%200%201-.683-1.06l2.008-4.418.003-.006-.004-.009-.006-.006-.008-.001q-.005%200-.009.004%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M4.72.22a.75.75%200%200%201%201.06%200l1%20.999a3.5%203.5%200%200%201%202.441%200l.999-1a.748.748%200%200%201%201.265.332.75.75%200%200%201-.205.729l-.775.776c.616.63.995%201.493.995%202.444v.327q0%20.15-.025.292c.408.14.764.392%201.029.722l1.968-.787a.75.75%200%200%201%20.556%201.392L13%207.258V9h2.25a.75.75%200%200%201%200%201.5H13v.5q-.002.615-.141%201.186l2.17.868a.75.75%200%200%201-.557%201.392l-2.184-.873A5%205%200%200%201%208%2016a5%205%200%200%201-4.288-2.427l-2.183.873a.75.75%200%200%201-.558-1.392l2.17-.868A5%205%200%200%201%203%2011v-.5H.75a.75.75%200%200%201%200-1.5H3V7.258L.971%206.446a.75.75%200%200%201%20.558-1.392l1.967.787c.265-.33.62-.583%201.03-.722a1.7%201.7%200%200%201-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72%201.28a.75.75%200%200%201%200-1.06m.53%206.28a.75.75%200%200%200-.75.75V11a3.5%203.5%200%201%200%207%200V7.25a.75.75%200%200%200-.75-.75ZM6.173%205h3.654A.17.17%200%200%200%2010%204.827V4.5a2%202%200%201%200-4%200v.327c0%20.096.077.173.173.173%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5%205.782V2.5h-.25a.75.75%200%200%201%200-1.5h6.5a.75.75%200%200%201%200%201.5H11v3.282l3.666%205.76C15.619%2013.04%2014.543%2015%2012.767%2015H3.233c-1.776%200-2.852-1.96-1.899-3.458Zm-2.4%206.565a.75.75%200%200%200%20.633%201.153h9.534a.75.75%200%200%200%20.633-1.153L12.225%2010.5h-8.45ZM9.5%202.5h-3V6c0%20.143-.04.283-.117.403L4.73%209h6.54L9.617%206.403A.75.75%200%200%201%209.5%206Z%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1.75%202.5h10.5a.75.75%200%200%201%200%201.5H1.75a.75.75%200%200%201%200-1.5m4%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5m0%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5M2.5%207.75v6a.75.75%200%200%201-1.5%200v-6a.75.75%200%200%201%201.5%200%22/%3E%3C/svg%3E');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#planweekly-update" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="blowinding&#39;s blog" class="md-header__button md-logo" aria-label="blowinding's blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            blowinding's blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Scaling Router Queues
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Introduction

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="blowinding&#39;s blog" class="md-nav__button md-logo" aria-label="blowinding's blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    blowinding's blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#planweekly-update" class="md-nav__link">
    <span class="md-ellipsis">
      
        PLAN(WEEKLY UPDATE)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PLAN(WEEKLY UPDATE)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overall-plan-icnp-2026" class="md-nav__link">
    <span class="md-ellipsis">
      
        OVERALL PLAN （ICNP 2026）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goals-from-previous-week" class="md-nav__link">
    <span class="md-ellipsis">
      
        GOALS FROM PREVIOUS WEEK
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updates-from-previous-week" class="md-nav__link">
    <span class="md-ellipsis">
      
        UPDATES FROM PREVIOUS WEEK
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-design" class="md-nav__link">
    <span class="md-ellipsis">
      
        - 完成DESIGN
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="- 完成DESIGN">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#next-week-plan" class="md-nav__link">
    <span class="md-ellipsis">
      
        NEXT WEEK PLAN
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        - 开始implementation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#details" class="md-nav__link">
    <span class="md-ellipsis">
      
        DETAILS
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DETAILS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#background" class="md-nav__link">
    <span class="md-ellipsis">
      
        BACKGROUND
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BACKGROUND">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qos" class="md-nav__link">
    <span class="md-ellipsis">
      
        QoS
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        网络设备（路由器）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网络设备（路由器）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bcm88480" class="md-nav__link">
    <span class="md-ellipsis">
      
        路由器的结构（BCM88480）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#motivation" class="md-nav__link">
    <span class="md-ellipsis">
      
        MOTIVATION
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MOTIVATION">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        目前路由器遇到的瓶颈
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        更丰富的调度策略与更多的物理队列并不等价
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#todo" class="md-nav__link">
    <span class="md-ellipsis">
      
        为什么其他工作不行（TODO）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="为什么其他工作不行（TODO）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pifo" class="md-nav__link">
    <span class="md-ellipsis">
      
        PIFO系列
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-idea" class="md-nav__link">
    <span class="md-ellipsis">
      
        BASIC IDEA
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BASIC IDEA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        虚拟队列
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        优先级映射
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#challenge" class="md-nav__link">
    <span class="md-ellipsis">
      
        Challenge
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Challenge">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#threshold-is-hard-to-set" class="md-nav__link">
    <span class="md-ellipsis">
      
        threshold is hard to set
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#design" class="md-nav__link">
    <span class="md-ellipsis">
      
        DESIGN
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DESIGN">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#goals" class="md-nav__link">
    <span class="md-ellipsis">
      
        GOALS
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        OVERVIEW
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sp" class="md-nav__link">
    <span class="md-ellipsis">
      
        SP
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-todo" class="md-nav__link">
    <span class="md-ellipsis">
      
        - 映射分析（TODO）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="- 映射分析（TODO）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        公平调度
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-todo_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        - 映射策略（TODO）
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-todo_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        - 映射分析（TODO）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="- 映射分析（TODO）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shaper" class="md-nav__link">
    <span class="md-ellipsis">
      
        Shaper
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combine-work-conserving-schedule-node-and-non-work-conserving-schedule-nodetodo" class="md-nav__link">
    <span class="md-ellipsis">
      
        combine work-conserving-schedule node and non-work-conserving-schedule node（TODO）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hierarchy-admission-and-mappingtodo" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hierarchy admission and mapping（TODO）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        IMPLEMENTATION
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-hqostodo" class="md-nav__link">
    <span class="md-ellipsis">
      
        - 传统HQoS的实现（TODO）
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        REFERENCE
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


              
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Scaling Router Queues</h1>

<h2 id="planweekly-update">PLAN(WEEKLY UPDATE)</h2>
<h3 id="overall-plan-icnp-2026">OVERALL PLAN （ICNP 2026）</h3>
<ul>
<li>BACKGROUND &amp; MOTIVATION 2 week DONE</li>
<li>DESIGN 4 week ONGOING<ul>
<li>design  skeleton ONGOING</li>
<li>design detail DELAY</li>
</ul>
</li>
<li>IMPLEMENTATION 6 weeks TODO</li>
<li>EXPERIMENTS 4 weeks TODO</li>
</ul>
<hr />
<h3 id="goals-from-previous-week">GOALS FROM PREVIOUS WEEK</h3>
<ul>
<li>完成初步DESIGN<ul>
<li>SP调度、公平调度、shaper调度算法</li>
<li>SP调度优先级映射算法</li>
<li>SP调度、公平调度阈值策略</li>
</ul>
</li>
</ul>
<hr />
<h3 id="updates-from-previous-week">UPDATES FROM PREVIOUS WEEK</h3>
<h2 id="-design">- 完成DESIGN</h2>
<h3 id="next-week-plan">NEXT WEEK PLAN</h3>
<h2 id="-implementation">- 开始implementation</h2>
<h2 id="details">DETAILS</h2>
<h3 id="background">BACKGROUND</h3>
<h4 id="qos">QoS</h4>
<ul>
<li>QoS<ul>
<li>QoS描述了网络在资源受限条件下对不同流量类型进行差异化处理的能力，以满足各种业务的性能需求（例如带宽、延迟、抖动和丢包率）的保证。[1]</li>
<li>SLA是服务提供商与客户之间的一种正式承诺性合同，用于定义具体的服务质量指标、责任和保障措施。SLA 的核心作用是在业务层面将用户的 QoS 需求转化为可衡量、可执行的服务等级目标。[2]</li>
<li>传统 IP 网络的 Best-Effort 机制无法保证性能，因而 QoS 技术（如 DiffServ）引入了按一些机制来实现可控的服务质量。[3]</li>
<li>为了保证QoS，目前有work conserving schedule和non work conserving schedule等调度算法<ul>
<li>schedule有DWRR[4]、SP[5]、WFQ[6]等算法</li>
<li>traffic shaping</li>
<li>traffic policing一般使用token bucket[7]</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>HQoS<ul>
<li>HQoS定义<ul>
<li>随着用户规模增加和业务种类多样化，传统单层 QoS 已难满足对不同用户和不同业务的细粒度服务要求。因此在接入网尤其是运营商边缘网关中引入了层次化 QoS（Hierarchical QoS, HQoS）机制。[8]</li>
</ul>
</li>
<li>HQoS功能<ul>
<li>HQoS 在传统 QoS 的基础上增加了多级调度结构，通过树形队列结构实现对服务、用户和用户组等多个层次的差异化调度，从而在接入网环境中更有效地保证 SLA 级别的 QoS 目标。</li>
<li><strong><em>画图举个例子（TODO）</em></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h4 id="_1">网络设备（路由器）</h4>
<ul>
<li>QoS（HQoS）大多在网络设备（路由器）中实现<ul>
<li>博通[9]、[10]</li>
<li>华为[11]</li>
<li>思科[12]</li>
</ul>
</li>
</ul>
<h5 id="bcm88480">路由器的结构（BCM88480）</h5>
<ul>
<li><strong><em>路由器进行QoS完整的过程（画图TODO）</em></strong><ul>
<li>由于Ingress缓存较大，主要的QoS大多发生在Ingress内</li>
<li>首先在NP进行流分类和流标记</li>
<li>Ingress入队<ul>
<li>标记映射到VOQ</li>
<li>The TAR returns to the CGM Packet-Enqueue-Request that is evaluated for admission by the CGM based on available resources, queue-size, and queue parameters, resulting in an admit/drop decision. </li>
<li>If the packet is admitted, the queue number and start-SRAM buffer, along with additional packet information, are passed to the SRAM-Queue-Manager (SQM). Otherwise, the packet copy is discarded. If all packet copies have been discarded, then the packet’s Start-Buffers are sent to the SPB to be freed. The SQM allocates a Packet-Descriptor (PD) and links it to the queue.</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>路由器如何维护队列<ul>
<li>Queue Info Table、PD Table、SRAM buffer</li>
<li>Queue Info Table每个表项维护头尾指针</li>
<li>在broadcom中，有CGM、ingress credit scheduler、SQM维护相关信息</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>egress credit scheduler进行调度<ul>
<li>The function of the egress credit scheduler is to allocate bandwidth to the VOQs. The scheduler allocates the bandwidth by sending credits to the competing VOQs. When a VOQ receives a credit, it is granted the right to send data to the target port. The worth, in bytes, of one credit is configurable (for example, 2 KB). Traffic shaping at all levels (that is, device, interface, OTM port, aggregate, and queue) is accomplished by shaping the credit allocation by the scheduler.</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>Ingress出队<ul>
<li>When credit balance is positive, a Dequeue-Command with Dequeue-Command-Bytes is issued to the SRAM queue manager. The SRAM queue manager traverses the queue, dequeuing several packets. Until the queue becomes empty OR until the Dequeue-Command-Bytes are exhausted</li>
<li>The SRAM buffer manager reads the packet, updates the SRAM buffer user-count, and frees the buffer. The packet data is read and sent to the Ingress Transmit Packet Processor (ITPP) and then to the Transmit queues that have multiple contexts according to the source (SRAM/DRAM).</li>
</ul>
</li>
</ul>
<hr />
<h3 id="motivation">MOTIVATION</h3>
<h4 id="_2">目前路由器遇到的瓶颈</h4>
<ul>
<li>目前，支持更丰富的调度策略，则需要更多的队列<ul>
<li>如何定义更丰富的调度策略<ul>
<li>更精细的流量标记和分类<ul>
<li>依照用户组分类-&gt;依照用户分类，分类更加精细</li>
<li>不同用户的流量可以进行不同的调度</li>
<li><strong><em>画图举个例子（TODO）</em></strong></li>
</ul>
</li>
<li>目前的路由器架构，为什么更丰富的调度策略需要更多的队列<ul>
<li>当前路由器架构，带有标记的包会被引导至对应的物理队列</li>
</ul>
</li>
<li>需要维护更多的队列会带来什么代价<ul>
<li>queue info table开销增大<ul>
<li>对于BCM88480，一共有32K个VOQ，按照每个QIT只存储head ptr、tail ptr，字长为64bit估计，需要0.48MB缓存存储QIT，占约1/16</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>为什么这个代价需要优化<ul>
<li>维护队列的缓存存放在片内缓存[23]</li>
<li>片外缓存或许可以存放报文，但是片内缓存无法维护更多的队列（存在极限）</li>
<li>片上 SRAM 制程的下降已经远落后于逻辑电路制程的下降，造成功耗更高、面积效率更低，因此SRAM不能大容量扩展[13]、[14]、[15]</li>
<li>目前单位带宽的SRAM容量下降了4倍[16]</li>
</ul>
</li>
</ul>
<hr />
<h4 id="_3">更丰富的调度策略与更多的物理队列并不等价</h4>
<ul>
<li>QoS服务的本质是差异化处理</li>
<li>调度本质意义是改变包进入发送队列的分布（时间、顺序）[17]</li>
<li>目前存在其他的方式改变包进入发送队列的分布(SP-PIFO[18]、AIFO[19]、PACKS[20]）</li>
</ul>
<hr />
<h4 id="todo"><strong><em>为什么其他工作不行（TODO）</em></strong></h4>
<h5 id="pifo">PIFO系列</h5>
<ul>
<li>FIFO原语<ul>
<li>SP-PIFO<ul>
<li>不支持Hierarchy Schedule以及non work-conserving scheduling algorithms.</li>
</ul>
</li>
<li>AIFO<ul>
<li>不支持Hierarchy Schedule以及non work-conserving scheduling algorithms.</li>
</ul>
</li>
<li>PACKS<ul>
<li>不支持Hierarchy Schedule以及non work-conserving scheduling algorithms.</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>PIFO原语<ul>
<li>vPIFO[21]<ul>
<li>不支持non work-conserving scheduling algorithms</li>
</ul>
</li>
<li>BMW tree[22]<ul>
<li>不支持non work-conserving scheduling algorithms</li>
</ul>
</li>
<li>BBQ<ul>
<li>不支持non work-conserving scheduling algorithms</li>
</ul>
</li>
<li>Loom<ul>
<li>不支持过多的流，只能小规模使用</li>
</ul>
</li>
</ul>
</li>
<li>BC_PQP[23]<ul>
<li>无优先级调度</li>
</ul>
</li>
</ul>
<hr />
<h3 id="basic-idea">BASIC IDEA</h3>
<h4 id="_4">虚拟队列</h4>
<ul>
<li>基础结构<ul>
<li>根节点处有限速，限制输出总带宽</li>
<li>节点<ul>
<li>虚拟队列（计数器）</li>
<li>调度策略</li>
<li>入队自叶节点开始，向根节点逐级增加计数器</li>
<li>出队自根节点开始，按调度策略选择叶节点扣减计数器</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h4 id="_5">优先级映射</h4>
<ul>
<li>基础结构<ul>
<li>参考PACKS进行优先级映射</li>
<li>自高到低扫描优先级队列，当$W.\mathrm{quantile}(r) \le \frac{1}{1-k} \cdot \sum_{i=1}^{j} \frac{B_j - b_j}{B}$且$b_i&lt;B_i$时，进入第i个优先级队列</li>
</ul>
</li>
</ul>
<hr />
<h4 id="challenge">Challenge</h4>
<h5 id="threshold-is-hard-to-set">threshold is hard to set</h5>
<ul>
<li>若阈值过小，会导致不必要的丢包</li>
<li>若阈值过大，会导致更多的突发流进入TM，导致缓存系统丢包严重，影响结果的确定性</li>
<li>阈值需要动态调整，以满足调度需要<ul>
<li>如果高优先级包和低优先级包共享同一个物理队列，低优先级包先到达并占满队列，高优先级后到达，低优先级包需要让出缓存空间给高优先级包</li>
</ul>
</li>
</ul>
<hr />
<h3 id="design">DESIGN</h3>
<h4 id="goals">GOALS</h4>
<ul>
<li>使用虚拟队列近似实现HQoS<ul>
<li>模拟SP调度、公平调度、shaping</li>
<li>调度算法的近似程度<ul>
<li>分布：单个流中单位时间出包的个数<ul>
<li><strong><em>TODO</em></strong></li>
</ul>
</li>
<li>顺序：单位时间窗内出队包顺序差异<ul>
<li><strong><em>TODO</em></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h4 id="overview">OVERVIEW</h4>
<ul>
<li>准入<ul>
<li>虚拟队列控制准入<ul>
<li>计数器维护通过节点的数据包长度<ul>
<li>一条流中数据包长度不一</li>
</ul>
</li>
</ul>
</li>
<li>为什么需要有准入<ul>
<li>non-work-conserving schedule算法需要准入近似控制，准入模块通过丢包可以暂缓数据包发送</li>
<li>buffer-management有对队列进行准入控制的模块[9] 、[10]，如果将物理队列从TM中剔除，原有对队列的准入控制应当也一并在虚拟队列中实现</li>
<li>准入可改变数据包的分布，从而近似模拟调度的结果[19]</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>映射<ul>
<li>为什么需要有映射<ul>
<li>通过映射可以使用粗粒度优先级队列模拟细粒度优先级队列[18]</li>
<li>准入策略不足以完全实现调度，当虚拟队列未满载，并且入速率大于出速率，准入无法对进入的数据包进行控制，因此需要优先级调度</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h4 id="sp">SP</h4>
<ul>
<li>目标<ul>
<li>为某些流提供绝对的优先</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>调度策略<ul>
<li>子队列优先级从高到低依次调度</li>
<li>维护bitmap，使用find first set提取最高优先级的rank</li>
</ul>
</li>
</ul>
<hr />
<pre><code class="language-Cpp">doDequeue(expectSize) {
    totalScheduleSize = 0;
    for(cls in spQueue &amp;&amp; expectSize &lt;= totalScheduleSize) {
        totalScheduleSize += cls.doDequeue(expectSize - totalScheduleSize);
    }
    return totalScheduleSize;
}
</code></pre>
<hr />
<ul>
<li>阈值策略<ul>
<li>当高优先级包到达时，低优先级包应当为高优先级包腾出缓存空间</li>
<li>当高优先级包未到达时，如果优先级数目小于物理优先级队列数目，低优先级包可以尽可能多的利用缓存空间</li>
<li>$T_i(t)=\alpha(B-\sum_{j=0}^{i}q_j(t))$<ul>
<li>$T_i(t)$表示第i个优先级虚队列的阈值（$i$越小优先级越高）</li>
<li>$B$表示父节点的阈值</li>
<li>$\sum_{j=0}^{i}q_j(t)$表示优先级高于或等于$i$的虚队列的计数之和</li>
</ul>
</li>
<li>可以使用按照优先级递减来调整阈值（0-1，1-/2，2-/4）</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>准入分析<ul>
<li>优先级从高到低排列，除了第一个计数器为正数的队列，其他低优先级队列均满载，即入速率大于出速率，最终执行准入策略后得到的结果为理想结果<ul>
<li>按照出队策略，优先级从高到低排列，当高优先级计数器为正数时，低优先级出队速率为0，因此低优先级队列会按照入队速率累积</li>
</ul>
</li>
<li>阈值策略可以解决低优先级包和高优先级包均以大于出队速率入队，此时低优先级包不应占用过多的缓存，高优先级计数器阈值会“抢走”低优先级的阈值，导致低优先级数据包进入物理队列的过程得以遏制</li>
<li>当高优先级抢走低优先级的阈值之后，由于阈值策略，高优先级数据包并没有占满B，因此低优先级仍会剩余阈值，保证在高优先级流结束后，低优先级的流不会因阈值过低而丢包</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>映射策略<ul>
<li>PACKS<ul>
<li>数据包到达时，自高到低扫描优先级队列，当$W.\mathrm{quantile}(r) \le \frac{1}{1-k} \cdot \sum_{i=1}^{j} \frac{B_j - b_j}{B}$且$b_i&lt;B_i$时，进入第i个优先级队列</li>
<li><strong><em>PACKS针对于无穷多个优先级进行设计，而我们只需对有限多个优先级进行处理，因此可针对该点进行优化或重新设计（TODO）</em></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h2 id="-todo">- <strong><em>映射分析（TODO）</em></strong></h2>
<h4 id="_6">公平调度</h4>
<ul>
<li>目标<ul>
<li>公平分配每个流的带宽，做到per-flow isolation</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>调度策略<ul>
<li>为每个子队列维护一个deficit，每次调度deficit扣减调度出队的包长度</li>
<li>deficit大于0可被调度，小于等于0不可被调度</li>
<li>当计数器为0时，认为该队列为非活跃队列，计数器置为0</li>
</ul>
</li>
</ul>
<hr />
<pre><code class="language-Cpp">doDequeue(expectSize) {
    totalScheduleSize = 0;
    while (totalScheduleSize &lt;= expectSize) {
        scheduleSize = dwrrQueue[ptr].doDequeue(min(expectSize,dwrrQueue[ptr].deficit));
        dwrrQueue[ptr].deficit -= scheduleSize;
        totalScheduleSize += scheduleSize;
        // if queue is empty, set deficit 0
        if (dwrrQueue[ptr].count &lt;= 0) {
            dwrrQueue[ptr].deficit = 0;
        }
        // if deficit is negative, add quantum
        // if ptr queue is empty or deficit is negative, switch ptr
        if (dwrrQueue[ptr].deficit &lt;= 0) {
            ptr = (ptr + 1) % length;
            dwrrQueue[ptr].deficit += dwrrQueue[ptr].quantum;
        }
    }

    return totalScheduleSize;
}
</code></pre>
<hr />
<ul>
<li>阈值策略<ul>
<li>如果为公平调度，则阈值策略为DT</li>
<li>如果为加权公平调度<ul>
<li>如果不同权重的流同时到达，权重大的流可以占到更多的缓存</li>
<li>$T_i(t)=\alpha(B-\sum_{j=0}^{n}\frac{\omega_j}{\omega_i}\times{}{q_j(t)})$</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>准入分析<ul>
<li>儿子节点的数据包到达速率小于分配的带宽时，不需要进行限制，因为没有发生带宽的争用</li>
<li>每个儿子节点的虚拟队列达到阈值后，且入速率大于出速率，最终执行准入策略后得到的结果为理想结果</li>
<li><strong><em>阈值分析（TODO）</em></strong></li>
</ul>
</li>
</ul>
<hr />
<h2 id="-todo_1">- <strong><em>映射策略（TODO）</em></strong></h2>
<h2 id="-todo_2">- <strong><em>映射分析（TODO）</em></strong></h2>
<h4 id="shaper">Shaper</h4>
<ul>
<li>目标<ul>
<li>对流进行限速</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>调度策略<ul>
<li>由于每次调度之间的时间间隔固定，可以每次从计数器扣减$T*r$字节</li>
</ul>
</li>
</ul>
<hr />
<pre><code class="language-Cpp">doDequeue(expectSize) {
    // sizePerInterval is CIR * interval between root schedule
    totalScheduleSize = cls.doDequeue(min(expectSize, sizePerInterval));

    return totalScheduleSize;
}
</code></pre>
<hr />
<h4 id="combine-work-conserving-schedule-node-and-non-work-conserving-schedule-nodetodo"><strong><em>combine work-conserving-schedule node and non-work-conserving-schedule node（TODO）</em></strong></h4>
<hr />
<h4 id="hierarchy-admission-and-mappingtodo"><strong><em>Hierarchy admission and mapping（TODO）</em></strong></h4>
<hr />
<h2 id="implementation">IMPLEMENTATION</h2>
<h2 id="-hqostodo">- <strong><em>传统HQoS的实现（TODO）</em></strong></h2>
<h2 id="reference">REFERENCE</h2>
<p>[1] https://support.huawei.com/enterprise/zh/doc/EDOC1100335696/f1b1b569
[2] https://en.wikipedia.org/wiki/Service-level_agreement
[3] https://en.wikipedia.org/wiki/Quality_of_service
[4] Efficient Fair Queueing using Deficit Round Robin
[5] 
[6] Analysis and Simulation of a Fair Queueing Algorithm
[7] https://info.support.huawei.com/info-finder/encyclopedia/en/HQoS.html
[8] An Internet-Wide Analysis of Traffic Policing
[9] https://docs.broadcom.com/doc/88480-DG1-PUB
[10] https://docs.broadcom.com/doc/88800-DG1-PUB
[11] https://support.huawei.com/enterprise/zh/doc/EDOC1100464252/da76c2c0?idPath=24030814|9856750|22715517|9858994|15969
[12] https://www.ciscolive.com/c/dam/r/ciscolive/global-event/docs/2024/pdf/BRKARC-2096.pdf</p>
<hr />
<p>[13] Enabling static random-access memory cell scaling with monolithic 3D integration of 2D field-effect transistors
[14] SRAM Cell Design Challenges in Modern Deep Sub-Micron Technologies: An Overview
[15] https://semiengineering.com/sram-scaling-issues-and-what-comes-next/
[16] Occamy: A Preemptive Buffer Management for On-chip Shared-memory Switches
[17] BBQ: A Fast and Scalable Integer Priority Queue for Hardware Packet Scheduling
[18] SP-PIFO: Approximating Push-In First-Out Behaviors using Strict-Priority Queues
[19] Programmable packet scheduling with a single queue
[20] Everything Matters in Programmable Packet Scheduling
[21] vPIFO: Virtualized Packet Scheduler for Programmable Hierarchical Scheduling in High-Speed Networks</p>
<hr />
<p>[22] BMW Tree: Large-scale, High-throughput and Modular PIFO Implementation using Balanced Multi-Way Sorting Tree
[23]  <a href="https://www.cisco.com/c/en/us/td/docs/iosxr/ncs5500/system-monitoring/78x/b-system-monitoring-cg-ncs5500-78x/oor-handling.html">System Monitoring Configuration Guide for Cisco NCS 5500 Series Routers, IOS XR Release 7.8.x - Graceful Handling of Out of Resource Situations [Cisco Network Convergence System 5500 Series] - Cisco</a>
[24] Improving TCP performance with bufferless token bucket policing: A TCP friendly policer</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["search.suggest", "search.highlight", "search.share", "navigation.tabs", "navigation.path", "navigation.top", "navigation.footer", "navigation.indexes", "content.code.copy", "content.code.select"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>